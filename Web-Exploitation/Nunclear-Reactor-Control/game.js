let reactorTemp = 0;
const maxTemp = 1000;
const minSafeTemp = 0;
const maxSafeTemp = 500;

const temperatureDisplay = document.getElementById('temperatureDisplay');
const gaugeFill = document.getElementById('gaugeFill');
const reactorCore = document.getElementById('reactorCore');
const reactorStatus = document.getElementById('reactorStatus');
const safetyLevel = document.getElementById('safetyLevel');
const warningDisplay = document.getElementById('warningDisplay');
const heatButton = document.getElementById('heatButton');

const encryptedFlag = 'S2FsaWJlcntyMzRjdDBSX3QzbXBfMHYzckZsOHd9';

function updateDisplay() {
    temperatureDisplay.textContent = `${reactorTemp}¬∞C`;
    
    const percentage = Math.min((reactorTemp / maxTemp) * 100, 100);
    gaugeFill.style.width = `${percentage}%`;
    
    if (reactorTemp < 0) {
        gaugeFill.style.background = 'linear-gradient(90deg, #2196f3, #03a9f4)';
        reactorCore.style.borderColor = '#2196f3';
        reactorCore.querySelector('.core-inner').style.background = 'radial-gradient(circle, #2196f3, #0288d1)';
    } else if (reactorTemp > maxSafeTemp) {
        gaugeFill.style.background = 'linear-gradient(90deg, #f44336, #e91e63)';
        reactorCore.style.borderColor = '#f44336';
        reactorCore.querySelector('.core-inner').style.background = 'radial-gradient(circle, #f44336, #e91e63)';
    } else {
        gaugeFill.style.background = 'linear-gradient(90deg, #ffc107, #ff9800)';
        reactorCore.style.borderColor = '#3a3a3a';
        reactorCore.querySelector('.core-inner').style.background = 'radial-gradient(circle, #ffc107, #ff9800)';
    }
}

function updateStatus() {
    if (reactorTemp < minSafeTemp) {
        reactorStatus.textContent = 'CRITICAL';
        reactorStatus.style.color = '#2196f3';
        safetyLevel.textContent = 'EMERGENCY';
        safetyLevel.style.color = '#2196f3';
    } else if (reactorTemp > maxSafeTemp) {
        reactorStatus.textContent = 'OVERHEATING';
        reactorStatus.style.color = '#f44336';
        safetyLevel.textContent = 'DANGER';
        safetyLevel.style.color = '#f44336';
    } else if (reactorTemp > maxSafeTemp * 0.8) {
        reactorStatus.textContent = 'WARNING';
        reactorStatus.style.color = '#ffc107';
        safetyLevel.textContent = 'ELEVATED';
        safetyLevel.style.color = '#ffc107';
    } else {
        reactorStatus.textContent = 'STABLE';
        reactorStatus.style.color = '#4caf50';
        safetyLevel.textContent = 'NORMAL';
        safetyLevel.style.color = '#4caf50';
    }
}

function checkCriticalState() {
    if (reactorTemp < 0 || reactorTemp > 999999) {
        triggerDebugMode();
    } else if (reactorTemp > maxSafeTemp) {
        showWarning();
    } else {
        warningDisplay.classList.remove('active');
    }
}

function triggerDebugMode() {
    const decryptedFlag = atob(encryptedFlag);
    
    warningDisplay.className = 'warning-display active critical';
    warningDisplay.innerHTML = `
        <div class="warning-title">‚ö†Ô∏è SYSTEM MALFUNCTION DETECTED</div>
        <div class="warning-message">
            Critical temperature anomaly detected. Reactor control system entering emergency debug mode.
        </div>
        
        <div class="debug-info">
            <div class="debug-label">ERROR CODE:</div>
            <div class="debug-value">0x${Math.abs(reactorTemp).toString(16).toUpperCase()}</div>
            
            <div class="debug-label" style="margin-top: 10px;">TEMPERATURE STATE:</div>
            <div class="debug-value">${reactorTemp}¬∞C ${reactorTemp < 0 ? '(UNDERFLOW)' : '(OVERFLOW)'}</div>
            
            <div class="debug-label" style="margin-top: 10px;">SYSTEM MODULE:</div>
            <div class="debug-value">TemperatureController.js:127</div>
            
            <div class="debug-label" style="margin-top: 10px;">STACK TRACE:</div>
            <div class="debug-value">
                at ReactorCore.validateTemp() line 89<br>
                at TempController.update() line 127<br>
                at DebugHandler.trigger() line 42
            </div>
        </div>
        
        <div class="flag-container">
            <div class="flag-title">üö© SYSTEM FLAG LEAKED</div>
            <div class="flag-box">${decryptedFlag}</div>
        </div>
        
        <div class="warning-message" style="margin-top: 15px; color: #888; font-size: 12px;">
            <strong>Vulnerability:</strong> Global variable manipulation via JavaScript console<br>
            <strong>Attack Vector:</strong> Temperature variable exposed in global scope<br>
            <strong>Recommendation:</strong> Encapsulate variables and implement proper validation
        </div>
    `;
}

function showWarning() {
    warningDisplay.className = 'warning-display active error';
    warningDisplay.innerHTML = `
        <div class="warning-title">‚ö†Ô∏è WARNING: HIGH TEMPERATURE</div>
        <div class="warning-message">
            Reactor temperature exceeds safe operating limits. 
            Critical system failure imminent if temperature continues to rise.
        </div>
        <div class="debug-info">
            <div class="debug-label">CURRENT TEMPERATURE:</div>
            <div class="debug-value">${reactorTemp}¬∞C</div>
            <div class="debug-label" style="margin-top: 10px;">SAFE LIMIT:</div>
            <div class="debug-value">${maxSafeTemp}¬∞C</div>
        </div>
    `;
}

function increaseHeat() {
    reactorTemp += 5;
    
    heatButton.style.transform = 'scale(0.95)';
    setTimeout(() => {
        heatButton.style.transform = 'scale(1)';
    }, 100);
    
    updateDisplay();
    updateStatus();
    checkCriticalState();
}

heatButton.addEventListener('click', increaseHeat);

updateDisplay();
updateStatus();