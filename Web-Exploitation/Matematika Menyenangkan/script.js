let questions = [];
let currentQuestion = 0;
let score = 0;
let timeLeft = 1.0;
let timerInterval;

const encodedFlag = "S2FsaWJlcntqNHY0c2NyMXB0X2M0bnRfYjNfdHJ1NXQzZH0=";

function generateQuestions() {
    questions = [];
    for (let i = 0; i < 10; i++) {
        const num1 = Math.floor(Math.random() * 50) + 1;
        const num2 = Math.floor(Math.random() * 50) + 1;
        const operators = ['+', '-', '*'];
        const operator = operators[Math.floor(Math.random() * operators.length)];
        
        let answer;
        switch(operator) {
            case '+':
                answer = num1 + num2;
                break;
            case '-':
                answer = num1 - num2;
                break;
            case '*':
                answer = num1 * num2;
                break;
        }
        
        questions.push({
            question: `${num1} ${operator} ${num2}`,
            answer: answer
        });
    }
}

function startChallenge() {
    generateQuestions();
    currentQuestion = 0;
    score = 0;
    timeLeft = 1.0;
    
    document.getElementById('startScreen').style.display = 'none';
    document.getElementById('gameScreen').style.display = 'block';
    
    displayQuestion();
    startTimer();
    
    console.log('%câš ï¸ CTF CHALLENGE ACTIVE', 'color: #d4af37; font-size: 20px; font-weight: bold;');
    console.log('%cðŸ’¡ Hint: Waktu 1 detik untuk 10 soal? Sepertinya kamu perlu "bantuan"...', 'color: #3498db; font-size: 14px;');
    console.log('%cðŸ”§ Coba manipulasi variabel atau fungsi JavaScript!', 'color: #2ecc71; font-size: 14px;');
}

function displayQuestion() {
    if (currentQuestion < questions.length) {
        document.getElementById('question').textContent = questions[currentQuestion].question + ' = ?';
        document.getElementById('questionNumber').textContent = `${currentQuestion + 1}/10`;
        document.getElementById('score').textContent = score;
        document.getElementById('answer').value = '';
        document.getElementById('answer').focus();
    }
}

function startTimer() {
    const timerElement = document.getElementById('timer');
    timerInterval = setInterval(() => {
        timeLeft -= 0.1;
        timerElement.textContent = timeLeft.toFixed(1) + 's';
        
        if (timeLeft <= 0.5) {
            timerElement.classList.add('warning');
        }
        
        if (timeLeft <= 0) {
            endGame(false);
        }
    }, 100);
}

function checkAnswer() {
    const userAnswer = parseInt(document.getElementById('answer').value);
    const correctAnswer = questions[currentQuestion].answer;
    
    if (userAnswer === correctAnswer) {
        score++;
    }
    
    currentQuestion++;
    
    if (currentQuestion >= questions.length) {
        endGame(true);
    } else {
        displayQuestion();
    }
}

function endGame(completed) {
    clearInterval(timerInterval);
    document.getElementById('gameScreen').style.display = 'none';
    
    if (completed && score >= 10) {
        showFlag();
    } else {
        document.getElementById('resultScreen').style.display = 'block';
        document.getElementById('finalScore').textContent = score;
    }
}

function decodeFlag() {
    const decoded = atob(encodedFlag);
    return decoded;
}

function showFlag() {
    document.getElementById('successScreen').style.display = 'block';
    document.getElementById('successScore').textContent = score;

    const flag = decodeFlag();
    document.getElementById('flagValue').textContent = flag;
    
    console.log('%cðŸŽ‰ CONGRATULATIONS!', 'color: #2ecc71; font-size: 24px; font-weight: bold;');
    console.log('%cðŸš© FLAG: ' + flag, 'color: #d4af37; font-size: 18px; font-weight: bold;');
}

document.addEventListener('DOMContentLoaded', function() {
    const answerInput = document.getElementById('answer');
    if (answerInput) {
        answerInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkAnswer();
            }
        });
    }
});

console.log('%câš¡ Speed Math Challenge', 'color: #d4af37; font-size: 24px; font-weight: bold;');
console.log('%c1 detik untuk 10 soal? Mustahil untuk manusia!', 'color: #e74c3c; font-size: 16px;');
console.log('%cðŸ’¡ Tips: JavaScript berjalan di client-side...', 'color: #3498db; font-size: 14px;');